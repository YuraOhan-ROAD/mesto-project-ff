(()=>{"use strict";function e(e,t,n,o){t.classList.add(o.inputErrorClass),e.textContent=n,e.classList.add(o.errorClass)}var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"6ad6acad-99eb-47bd-a368-4655cfbe89ff","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Не удалось получить данные: ".concat(e.status))}function o(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))}function r(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))}var c=document.querySelector("#card-template").content;function a(e,t,n){var a=c.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),i=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-count"),d=a.querySelector(".card__like-button");return e.card.owner._id!==e.user._id?s.remove():s.addEventListener("click",(function(n){t(a,e)})),i.textContent=e.card.name,u.src=e.card.link,u.alt=e.card.name,l.textContent=e.card.likes.length,e.card.likes.forEach((function(t){t._id===e.user._id&&d.classList.add("card__like-button_is-active")})),u.addEventListener("click",n),d.addEventListener("click",(function(t){!function(e,t,n){(e.target.classList.contains("card__like-button_is-active")?r:o)(t).then((function(t){n.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}(t,e.card._id,l)})),a}function u(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",s),e.addEventListener("mousedown",l)}function i(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",s),e.removeEventListener("mousedown",l)}function s(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function l(e){e.target===e.currentTarget&&i(e.currentTarget)}var d,p,f=document.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),m=document.querySelector(".profile__edit-button"),h=document.querySelectorAll(".popup"),v=document.querySelectorAll(".popup__close"),y=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_new-card"),g=document.querySelector(".profile__image"),S=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.forms.edit_profile,L=E.elements.name,k=E.elements.description,C=document.forms["new-place"],x=document.querySelector(".popup_type_image"),T=document.querySelector(".popup__image"),U=document.querySelector(".popup__caption"),w=document.querySelector(".popup_type_edit-avatar"),A=document.querySelector(".profile__image-edit-button"),P=document.forms["edit-avatar"],D=P.elements.link,B=document.querySelector(".popup_type_delete");function j(e,t){d=e,p=t,u(B)}B.querySelector(".popup__button").addEventListener("click",(function(){var e;d&&(e=d,function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))}(p.card._id).then((function(){e.remove()})),i(B))}));var N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function O(e){T.src=e.target.src,T.alt=e.target.alt,U.textContent=e.target.alt,u(x)}function H(e){e.classList.contains("popup__button_loading")?(e.classList.remove("popup__button_loading"),e.textContent="Сохранить"):(e.classList.add("popup__button_loading"),e.textContent="Сохранить...")}function J(e){g.style="background-image: url(".concat(e,")")}Promise.all([fetch(t.baseUrl+"/cards",{method:"GET",headers:t.headers}).then((function(e){return n(e)})).catch((function(e){console.log(e)})),fetch(t.baseUrl+"/users/me",{headers:t.headers}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))]).then((function(e){e&&(0!==e[0].length&&e[0].forEach((function(t){var n=a({card:t,user:e[1]},j,O);f.appendChild(n)})),J(e[1].avatar),S.textContent=e[1].name,q.textContent=e[1].about)})),P.addEventListener("submit",(function(o){o.preventDefault();var r=D.value,c=document.querySelector(".avatar-link-input-error");H(o.target.querySelector(".popup__button")),function(t,n,o,r){fetch(t,{method:"HEAD"}).then((function(t){if(t.ok)if(t.headers.has("Content-Type")){if(t.headers.get("Content-Type").includes("image"))return!0;e(n,o,"Ссылка не ведет на изображение.",r)}else e(n,o,"Не удалось определить тип контента.",r);return e(n,o,"Не удалось получить данные.",r),!1})).catch((function(e){return console.log(e),!1}))}(r,c,D,N),function(e){return fetch(t.baseUrl+"/users/me/avatar",{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))}(r).then((function(e){return e||Promise.reject("Не удалось получить данные: ".concat(null==e?void 0:e.status))})).then((function(e){J(e.avatar),i(w)})).catch((function(e){console.log(e)})).finally((function(){H(o.target.querySelector(".popup__button"))}))})),A.addEventListener("click",(function(){u(w)})),m.addEventListener("click",(function(){u(_),L.value=S.textContent,k.value=q.textContent})),y.addEventListener("click",(function(){u(b)})),C.addEventListener("submit",(function(e){e.preventDefault(),H(e.target.querySelector(".popup__button"));var o,r,c={name:C["place-name"].value,link:C.link.value};(o=c.name,r=c.link,fetch(t.baseUrl+"/cards",{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:r})}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))).then((function(t){f.prepend(a({card:t,user:t.owner},j,O)),i(b),H(e.target.querySelector(".popup__button")),C.reset()}))})),v.forEach((function(e,t){e.addEventListener("click",(function(){i(h[t])}))})),E.addEventListener("submit",(function(e){var o,r;e.preventDefault(),H(e.target.querySelector(".popup__button")),(o=L.value,r=k.value,fetch(t.baseUrl+"/users/me",{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return n(e)})).catch((function(e){console.log(e)}))).then((function(t){S.textContent=t.name,q.textContent=t.about,i(_),H(e.target.querySelector(".popup__button"))}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){!function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);function c(t,n,o,r,c){!function(t,n,o){n.validity.valid?function(e,t,n){t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass)}(t,n,o):(n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),e(t,n,n.validationMessage,o))}(function(e,t){return e.querySelector(".".concat(t.id,"-error"))}(t,n),n,c),function(e,t,n){!function(e){return e.some((function(e){if(!e.validity.valid)return!0}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}(o,r,c)}o.forEach((function(e){e.addEventListener("input",(function(){c(t,e,o,r,n)}))})),o.forEach((function(e){e.addEventListener("focusout",(function(){c(t,e,o,r,n)}))}))}(n,t)}))}(N)})();